(()=>{window.onload=()=>{console.log("page is fully loaded")};let e=JSON.parse(sessionStorage.getItem("user")),t=e.client_id;const n=document.getElementById("searchTerm"),i=document.getElementById("cardCollection");let c=document.querySelectorAll("#decrease-btn"),a=document.querySelectorAll("#increase-btn"),s=document.querySelectorAll("#counter"),o=document.querySelectorAll("#updateButton"),l=document.querySelectorAll("#deleteButton"),d=document.querySelectorAll(".tag"),r=[],u=[],m=[],h=[];const f=`https://web-2-backend-22-23-batuhanayazz.onrender.com/clients/client/${t}/stock`;if(e){let e=y(f,"GET").then((async e=>{e.stock.forEach((e=>{u.push({fish_id:e.fish_id,quantity:e.quantity})}))}));y("https://web-2-backend-22-23-batuhanayazz.onrender.com/fish","GET").then((async t=>{await e,t.fish.forEach((e=>{r.push(e)}));let n=r.reduce(((e,t)=>(e[t.fish_id]=t,e)),{});m=u.map((e=>Object.assign(e,n[e.fish_id]))),p(m),v(m)}))}async function y(e,t){const n=await fetch(e,{method:t,headers:{"Content-Type":"application/json"}});return await n.json()}function v(e){n.addEventListener("keyup",(t=>{let n=t.target.value.toLowerCase();p(e.filter((e=>e.common_name.toLowerCase().includes(n)||e.scientific_name.toLowerCase().includes(n))))}))}function b(e){h=m.filter((t=>t.species_group==e)),p(h)}async function p(e){const t=e.map((e=>`\n                <div class="fish-box" id"${e.fish_id}">\n                <div class="img-container">\n                      <img src="${e.image_link}">\n                </div>\n                <div class="info-container">\n                 <h4>${e.species_group}</h4>\n                 <h2>${e.common_name}</h2>\n                 <h3>${e.scientific_name}</h3>\n                 <div class="counterButtons">\n                    <button id="decrease-btn" name="${e.fish_id}" class="min"><i class="bx bx-minus" id="decrease"></i></button>\n                    <input type="text" size="1" value="${e.quantity}" id="counter" name="${e.fish_id}" class="stockValue">\n                    <button id="increase-btn" name="${e.fish_id}" class="plus"><i class="bx bx-plus" id="increase"></i></button>\n                 </div>\n                 <div class="addButton">\n                    <button class="updateButton" id="updateButton" name="${e.fish_id}" type="submit">UPDATE</button>\n                    </div>\n                    </div>\n                    <button class="deleteButton" id="deleteButton">DELETE</button>\n                  </div>\n            `)).join("");i.innerHTML=t,c=document.querySelectorAll("#decrease-btn"),a=document.querySelectorAll("#increase-btn"),s=document.querySelectorAll("#counter"),o=document.querySelectorAll("#updateButton"),l=document.querySelectorAll("#deleteButton"),a.forEach(((e,t)=>{e.addEventListener("click",(()=>{s[t].value++}))})),c.forEach(((e,t)=>{e.addEventListener("click",(()=>{s[t].value--,s[t].value<0&&(s[t].value=0)}))})),function(e){let t=JSON.parse(sessionStorage.getItem("user"));o.forEach(((n,i)=>{n.addEventListener("click",(()=>{let n={client_id:t.client_id,fish_id:e[i].fish_id,quantity:s[i].value};E(f,"PUT",n).then((t=>{"Successfully updated your fish"==t.message?(console.log(t),alert(`The number of ${e[i].common_name} fish has been changed to ${s[i].value}`)):console.log(t),s[i].value<=10&&alert(`You have less than 10 ${e[i].common_name} left.`),window.location.reload()}))}))})),l.forEach(((n,i)=>{n.addEventListener("click",(()=>{let n={client_id:t.client_id,fish_id:e[i].fish_id,quantity:s[i].value};confirm(`Do you really want to delete ${e[i].common_name} ?`)&&E(f,"DELETE",n).then((t=>{"Fish successfully was deleted from your stock."==t.message?alert(`${e[i].common_name}, Successfully Deleted!`):console.log(t),window.location.reload()}))}))}))}(e)}async function E(e,t,n){const i=await fetch(e,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return await i.json()}allSpeciesFish.addEventListener("click",(()=>{v(m),p(m)})),africanCichlids.addEventListener("click",(()=>{b("African cichlids"),v(h)})),americanCichlids.addEventListener("click",(()=>{b("American cichlids"),v(h)})),livebearer.addEventListener("click",(()=>{b("Livebearer"),v(h)})),tetras.addEventListener("click",(()=>{b("Tetras"),v(h)})),d.forEach((e=>{e.addEventListener("click",(()=>{d.forEach((e=>e.classList.remove("active"))),e.classList.add("active")}))}))})();