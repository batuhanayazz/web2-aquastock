(()=>{window.onload=()=>{console.log("page is fully loaded")};let e=JSON.parse(sessionStorage.getItem("user")),t=e.client_id;const n=document.getElementById("searchTerm"),i=document.getElementById("cardCollection");let a=document.querySelectorAll("#decrease-btn"),c=document.querySelectorAll("#increase-btn"),s=document.querySelectorAll("#counter"),o=document.querySelectorAll("#updateButton"),l=document.querySelectorAll("#deleteButton"),d=document.querySelectorAll(".tag"),u=document.getElementById("catalogMessage"),r=[],m=[],h=[],f=[];const v=`https://web-2-backend-22-23-batuhanayazz.onrender.com/clients/client/${t}/stock`;if(e){let e=y(v,"GET").then((async e=>{e.stock.forEach((e=>{m.push({fish_id:e.fish_id,quantity:e.quantity})}))}));y("https://web-2-backend-22-23-batuhanayazz.onrender.com/fish","GET").then((async t=>{await e,t.fish.forEach((e=>{r.push(e)}));let n=r.reduce(((e,t)=>(e[t.fish_id]=t,e)),{});h=m.map((e=>Object.assign(e,n[e.fish_id]))),E(h),p(h)}))}async function y(e,t){const n=await fetch(e,{method:t,headers:{"Content-Type":"application/json"}});return await n.json()}function p(e){n.addEventListener("keyup",(t=>{let n=t.target.value.toLowerCase();E(e.filter((e=>e.common_name.toLowerCase().includes(n)||e.scientific_name.toLowerCase().includes(n))))}))}function b(e){f=h.filter((t=>t.species_group==e)),E(f)}async function E(e){const t=e.map((e=>`\n                <div class="fish-box" id"${e.fish_id}">\n                <div class="img-container">\n                      <img src="${e.image_link}">\n                </div>\n                <div class="info-container">\n                 <h4>${e.species_group}</h4>\n                 <h2>${e.common_name}</h2>\n                 <h3>${e.scientific_name}</h3>\n                 <div class="counterButtons">\n                    <button id="decrease-btn" name="${e.fish_id}" class="min"><i class="bx bx-minus" id="decrease"></i></button>\n                    <input type="text" size="1" value="${e.quantity}" id="counter" name="${e.fish_id}" class="stockValue">\n                    <button id="increase-btn" name="${e.fish_id}" class="plus"><i class="bx bx-plus" id="increase"></i></button>\n                 </div>\n                 <div class="addButton">\n                    <button class="updateButton" id="updateButton" name="${e.fish_id}" type="submit">UPDATE</button>\n                    </div>\n                    </div>\n                    <button class="deleteButton" id="deleteButton">DELETE</button>\n                  </div>\n            `)).join("");i.innerHTML=t,a=document.querySelectorAll("#decrease-btn"),c=document.querySelectorAll("#increase-btn"),s=document.querySelectorAll("#counter"),o=document.querySelectorAll("#updateButton"),l=document.querySelectorAll("#deleteButton"),c.forEach(((e,t)=>{e.addEventListener("click",(()=>{s[t].value++}))})),a.forEach(((e,t)=>{e.addEventListener("click",(()=>{s[t].value--,s[t].value<0&&(s[t].value=0)}))})),function(e){let t=JSON.parse(sessionStorage.getItem("user"));o.forEach(((n,i)=>{n.addEventListener("click",(()=>{let n={client_id:t.client_id,fish_id:e[i].fish_id,quantity:s[i].value};L(v,"PUT",n).then((t=>{"Successfully"==t.status&&(u.innerHTML=`<p style="background-color: #007a4d">The number of ${e[i].common_name} fish has been changed to ${s[i].value}</p>`,_()),s[i].value<=9&&setTimeout((()=>{u.innerHTML+=`<p style="background-color: red">You have less than 10 ${e[i].common_name} left.</p>`}),1e3)}))}))})),l.forEach(((n,i)=>{n.addEventListener("click",(()=>{let n={client_id:t.client_id,fish_id:e[i].fish_id,quantity:s[i].value};confirm(`Do you really want to delete ${e[i].common_name} ?`)&&L(v,"DELETE",n).then((t=>{"Successfully"==t.status?(u.innerHTML=`<p style="background-color: #007a4d">${e[i].common_name}, Successfully Deleted!</p>`,_(),setTimeout((()=>{window.location.reload()}),2e3)):console.log(t)}))}))}))}(e)}function _(){u.classList.add("fade-in"),setTimeout((()=>{u.classList.remove("fade-in"),u.classList.add("fade-out")}),2e3,u.classList.remove("fade-out"))}async function L(e,t,n){const i=await fetch(e,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return await i.json()}allSpeciesFish.addEventListener("click",(()=>{p(h),E(h),n.value=""})),africanCichlids.addEventListener("click",(()=>{b("African cichlids"),p(f),n.value=""})),americanCichlids.addEventListener("click",(()=>{b("American cichlids"),p(f),n.value=""})),livebearer.addEventListener("click",(()=>{b("Livebearer"),p(f),n.value=""})),tetras.addEventListener("click",(()=>{b("Tetras"),p(f),n.value=""})),d.forEach((e=>{e.addEventListener("click",(()=>{d.forEach((e=>e.classList.remove("active"))),e.classList.add("active")}))}))})();