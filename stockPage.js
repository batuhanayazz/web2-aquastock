(()=>{window.onload=()=>{clientStockFishQuantity=[]};let e=JSON.parse(sessionStorage.getItem("user")),t=e.client_id;const n=document.getElementById("searchTerm"),i=document.getElementById("cardCollection");let c=document.querySelectorAll("#decrease-btn"),s=document.querySelectorAll("#increase-btn"),a=document.querySelectorAll("#counter"),o=document.querySelectorAll("#updateButton"),l=document.querySelectorAll("#deleteButton"),d=document.querySelectorAll(".tag");const r=`https://web-2-backend-22-23-batuhanayazz.onrender.com/clients/client/${t}/stock`;let u=[],h=[],m=[];if(e){let e=f(r,"GET").then((async e=>{e.forEach((e=>{h.push({fish_id:e.fish_id,quantity:e.quantity})}))}));f("https://web-2-backend-22-23-batuhanayazz.onrender.com/fish","GET").then((async t=>{await e,t.forEach((e=>{u.push(e)}));let n=u.reduce(((e,t)=>(e[t.fish_id]=t,e)),{});m=h.map((e=>Object.assign(e,n[e.fish_id]))),v(m)}))}async function f(e,t){const n=await fetch(e,{method:t,headers:{"Content-Type":"application/json"}});return await n.json()}function y(e){fishSpeciesResult=m.filter((t=>t.species_group==e)),v(fishSpeciesResult),console.log(fishSpeciesResult)}async function v(e){const t=e.map((e=>`\n                <div class="fish-box" id"${e.fish_id}">\n                <div class="img-container">\n                      <img src="${e.image_link}">\n                </div>\n                <div class="info-container">\n                 <h4>${e.species_group}</h4>\n                 <h2>${e.common_name}</h2>\n                 <h3>${e.scientific_name}</h3>\n                 <div class="counterButtons">\n                    <button id="decrease-btn" name="${e.fish_id}" class="min"><i class="bx bx-minus" id="decrease"></i></button>\n                    <input type="text" size="1" value="${e.quantity}" id="counter" name="${e.fish_id}" class="stockValue">\n                    <button id="increase-btn" name="${e.fish_id}" class="plus"><i class="bx bx-plus" id="increase"></i></button>\n                 </div>\n                 <div class="addButton">\n                    <button class="updateButton" id="updateButton" name="${e.fish_id}" type="submit">UPDATE</button>\n                    </div>\n                    </div>\n                    <button class="deleteButton" id="deleteButton">DELETE</button>\n                  </div>\n            `)).join("");i.innerHTML=t,c=document.querySelectorAll("#decrease-btn"),s=document.querySelectorAll("#increase-btn"),a=document.querySelectorAll("#counter"),o=document.querySelectorAll("#updateButton"),l=document.querySelectorAll("#deleteButton"),s.forEach(((e,t)=>{e.addEventListener("click",(()=>{a[t].value++}))})),c.forEach(((e,t)=>{e.addEventListener("click",(()=>{a[t].value--,a[t].value<0&&(a[t].value=0)}))})),function(e){let t=JSON.parse(sessionStorage.getItem("user"));o.forEach(((n,i)=>{n.addEventListener("click",(()=>{let n={client_id:t.client_id,fish_id:e[i].fish_id,quantity:a[i].value};b(r,"PUT",n).then((t=>{alert(`The number of ${e[i].common_name} fish has been changed to ${a[i].value}`),a[i].value<=10&&alert(`You have less than 10 ${e[i].common_name} left.`),window.location.reload()}))}))})),l.forEach(((n,i)=>{n.addEventListener("click",(()=>{let n={client_id:t.client_id,fish_id:e[i].fish_id,quantity:a[i].value};confirm(`Do you really want to delete ${e[i].common_name} ?`)&&b(r,"DELETE",n).then((t=>{"Fish successfully was deleted from your store."==t.message?alert(`${e[i].common_name}, Successfully Deleted!`):console.log(t),window.location.reload()}))}))}))}(e)}async function b(e,t,n){const i=await fetch(e,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return await i.json()}n.addEventListener("keyup",(e=>{const t=e.target.value.toLowerCase();v(m.filter((e=>e.common_name.toLowerCase().includes(t)||e.scientific_name.toLowerCase().includes(t))))})),allSpeciesFish.addEventListener("click",(()=>{v(m)})),africanCichlids.addEventListener("click",(()=>{y("African cichlids")})),americanCichlids.addEventListener("click",(()=>{y("American cichlids")})),livebearer.addEventListener("click",(()=>{y("Livebearer")})),tetras.addEventListener("click",(()=>{y("Tetras")})),d.forEach((e=>{e.addEventListener("click",(()=>{d.forEach((e=>e.classList.remove("active"))),e.classList.add("active")}))}))})();