(()=>{window.onload=()=>{clientStockFishQuantity=[]};let e=JSON.parse(sessionStorage.getItem("user")),t=e.client_id;console.log(e);const n=document.getElementById("searchTerm"),o=document.getElementById("cardCollection");let i=document.querySelectorAll("#decrease-btn"),c=document.querySelectorAll("#increase-btn"),a=document.querySelectorAll("#counter"),s=document.querySelectorAll("#updateButton"),l=document.querySelectorAll("#deleteButton");const d=`https://web-2-backend-22-23-batuhanayazz.onrender.com/clients/client/${t}/stock`;let u=[],r=[];if(e){let e=m(d,"GET").then((async e=>{e.forEach((e=>{r.push({fish_id:e.fish_id,quantity:e.quantity})})),console.log(r)}));m("https://web-2-backend-22-23-batuhanayazz.onrender.com/fish","GET").then((async t=>{await e,t.forEach((e=>{u.push(e)}));let n=u.reduce(((e,t)=>(e[t.fish_id]=t,e)),{});console.log(n);let o=r.map((e=>Object.assign(e,n[e.fish_id])));console.log(o),h(o)}))}async function m(e,t){const n=await fetch(e,{method:t,headers:{"Content-Type":"application/json"}});return await n.json()}async function h(e){const t=e.map((e=>`\n                <div class="fish-box" id"${e.fish_id}">\n                <div class="img-container">\n                      <img src="${e.image_link}">\n                </div>\n                <div class="info-container">\n                 <h4>${e.species_group}</h4>\n                 <h2>${e.common_name}</h2>\n                 <h3>${e.scientific_name}</h3>\n                 <div class="counterButtons">\n                    <button id="decrease-btn" name="${e.fish_id}" class="min"><i class="bx bx-minus" id="decrease"></i></button>\n                    <input type="text" size="1" value="${e.quantity}" id="counter" name="${e.fish_id}" class="stockValue">\n                    <button id="increase-btn" name="${e.fish_id}" class="plus"><i class="bx bx-plus" id="increase"></i></button>\n                 </div>\n                 <div class="addButton">\n                    <button class="updateButton" id="updateButton" name="${e.fish_id}" type="submit">UPDATE</button>\n                    </div>\n                    </div>\n                    <button class="deleteButton" id="deleteButton">DELETE</button>\n                  </div>\n            `)).join("");o.innerHTML=t,i=document.querySelectorAll("#decrease-btn"),c=document.querySelectorAll("#increase-btn"),a=document.querySelectorAll("#counter"),s=document.querySelectorAll("#updateButton"),l=document.querySelectorAll("#deleteButton"),c.forEach(((e,t)=>{e.addEventListener("click",(()=>{a[t].value++}))})),i.forEach(((e,t)=>{e.addEventListener("click",(()=>{a[t].value--,a[t].value<0&&(a[t].value=0)}))})),function(e){let t=JSON.parse(sessionStorage.getItem("user"));s.forEach(((n,o)=>{n.addEventListener("click",(()=>{let n={client_id:t.client_id,fish_id:e[o].fish_id,quantity:a[o].value};f(d,"PUT",n).then((t=>{alert(`The number of ${e[o].common_name} fish has been changed to ${a[o].value}`),console.log(t),a[o].value<=10&&alert(`You have less than 10 ${e[o].common_name} left.`),window.location.reload()}))}))})),l.forEach(((n,o)=>{n.addEventListener("click",(()=>{let n={client_id:t.client_id,fish_id:e[o].fish_id,quantity:a[o].value};confirm(`Do you really want to delete ${e[o].common_name} ?`)&&f(d,"DELETE",n).then((t=>{alert(`${e[o].common_name}, Successfully Deleted!`),window.location.reload()}))}))}))}(e)}async function f(e,t,n){const o=await fetch(e,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return await o.json()}n.addEventListener("keyup",(e=>{const t=e.target.value.toLowerCase(),n=filteredFish.filter((e=>e.common_name.toLowerCase().includes(t)||e.scientific_name.toLowerCase().includes(t)));h(n),console.log(n)}))})();